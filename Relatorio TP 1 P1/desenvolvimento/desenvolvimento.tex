
\chapter{Ambiente de Desenvolvimento}

O projeto é desenvolvido em um notebook Lenovo com processador Intel-Core i5
de 11º geração, com arquitetura x64. A frequência do processador é 2.4 GHz e possui 4 cores. 
O processador possui 8 GB de memória RAM disponível.
O sistema operacional do computador é Windows 11, mas o ambiente NS-3 é instalado 
através de WSL (Windows Subsystem for Linux) Ubuntu 22.04.1 LTS.

O ambiente NS-3 é instalado na pasta \verb|home| do WSL.
A Figura \ref{fig:ambiente-dev} ilustra o ambiente de desenvolvimento 
utilizado no projeto.

\begin{figure}[htb]
	\centering 
    \caption{Ambiente de desenvolvimento.}
	\includegraphics[width=\textwidth]{images/ambiente-dev.png}
	\label{fig:ambiente-dev}
	\fonte{Elaboração própria.}
\end{figure}

Essencialmente, é adotado um procedimento de duas etapas:

\begin{enumerate}
    \item O comando \verb|./ns3 build|, seguido de \verb|./ns3 run| com o programa 
    e argumentos de linha de comando desejados, é usado para executar o script C++ 
    com as funções do NS-3. A saída dos comandos será um arquivo XML;
    \item O comando \verb|./netanim| é usado para visualizar o arquivo XML exportado na etapa 1, obtendo a animação 
    exibida no lado direito da Figura \ref{fig:ambiente-dev}.
\end{enumerate}

\chapter{Parte 1: Comunicação Ponto-a-Ponto}

Para a parte 1, o objetivo é estabelecer conexões ponto-a-ponto entre clientes 
e um servidor. Usando \verb|nPackets = 2| e \verb|nClients = 3| nos argumentos 
da linha de comando, é obtido a topologia exibida 
na Figura \ref{fig:topologia-p1}.

\begin{figure}[htb]
	\centering 
    \caption{Topologia do experimento da parte 1.}
	\includegraphics[width=0.8\textwidth]{images/topologia-p1.png}
	\label{fig:topologia-p1}
	\fonte{Elaboração própria.}
\end{figure}

A Figura \ref{fig:resultado-p1} mostra os envios dos pacotes dos nós 
clientes para o nó servidor ao longo do tempo, com três clientes e cada um enviando 
dois pacotes.
 
\begin{figure}[htb]
	\centering 
    \caption{Resultado do experimento da parte 1.}
	\includegraphics[width=0.8\textwidth]{images/resultado-p1.png}
	\label{fig:resultado-p1}
	\fonte{Elaboração própria.}
\end{figure}

É possível observar que o tempo de propagação é muito menor do que o tempo de espera 
para envio dos pacotes. O tempo de RTT é de 3.69 ms, enquanto 1 segundo é esperado para 
enviar cada pacote. Em cada envio, o cliente envia para o nós 3 (servidor), e o servidor 
responde de volta para o nó cliente (0 a 2) que o requisitou.

Para tornar o gráfico mais didático, é possível aumentar o tempo de propagação
para 200 ms e reduzir a largura de banda para 5 kbps, 
obtendo o resultado da Figura \ref{fig:resultado-p1-mod}.
Vemos que o pacote gaasta mais tempo para sair do cliente e chegar ao servidor, e 
que o servidor demora 1.88 segundos a enviar a resposta ao cliente. 
Um dos fatores que contribuem para esse tempo é exibido abaixo:

\[ T_{prop} + \frac{banda}{tamanho} =  0.2 + \frac{5 \cdot 10^3 \un{kpbs}}{1024 \cdot 8} = 0.81  \un{s}\]

\noindent uma vez que o pacote enviado tem 1024 bytes de tamanho.

\begin{figure}[htb]
	\centering 
    \caption{Resultado do experimento da parte 1 - tempo de propagação 200 ms e largura de banda 5 kbps.}
	\includegraphics[width=0.8\textwidth]{images/resultado-p1-mod.png}
	\label{fig:resultado-p1-mod}
	\fonte{Elaboração própria.}
\end{figure}

Na pasta compactada no Moodle, está presente um teste com 5 clientes e cada um 
enviando 4 pacotes, bem como o print com as linhas de comando e arquivo txt.

\chapter{Parte 2: Rede Ethernet}

A topologia implementada nesse relatório está exibida na Figura 
\ref{fig:topologia-p2}. Basicamente, o nó 0 quer se comunicar
com o servidor (nó 6). Para isso, ele usa 4 nós CSMA intermediários 
que enviam a requisição ao servidor final. Nós CSMA utilizam o protocolo 
Carrier-Sense Multiple-Access (CSMA) que reduz o risco de colisões entre 
os pacotes enviados simultaneamente por vários nós no mesmo meio.

\begin{figure}[htb]
	\centering 
    \caption{Topologia da parte 2.}
	\includegraphics[width=0.8\textwidth]{images/topologia-p2.png}
	\label{fig:topologia-p2}
	\fonte{Elaboração própria.}
\end{figure}

Utilizando 4 nós CSMA intermediários enviando 10 pacotes, a sequência de envio 
dos pacotes em função do tempo está exibida na Figura \ref{fig:pacotes-p2}.

\begin{figure}[htb]
	\centering 
    \caption{Envio dos pacotes na toopologia da parte 2.}
	\includegraphics[width=0.8\textwidth]{images/pacotes-p2.png}
	\label{fig:pacotes-p2}
	\fonte{Elaboração própria.}
\end{figure}

O gráfico do atraso 
de ponto-a-ponto de uma requisição versus o número do pacote está exibido na Figura
\ref{fig:plot-atraso-p2}. A topologia original é a presente no exemplo \verb|second.cc|
da documentação do NS-3, enquanto a topologia modificada é a exibida na Figura 
\ref{fig:topologia-p2} desenvolvida na parte 2. O gráfico foi obtido a partir do  
seguinte procedimento:

\begin{itemize}
	\item Modifica os códigos para que eles salvem os atrasos em um arquivo txt 
	com as funções prontas de \verb|TxTrace| e \verb|RxTrace|;
	\item Carrega os arquivos txt em um arquivo Python e faz os plots com a biblioteca 
	\verb|matplotlib|.
\end{itemize}

\begin{figure}[htb]
	\centering 
    \caption{Atraso ponto-a-ponto em função do número do pacote para cada uma das topologias.}
	\includegraphics[width=0.8\textwidth]{images/plot-atraso-p2.png}
	\label{fig:plot-atraso-p2}
	\fonte{Elaboração própria.}
\end{figure}

É possível observar que o atraso na topologia original 
é menor do que na modificada. Isso é conforme esperado, uma vez que a 
topologia modificada possui um nó a mais, que aumenta o tempo de propagação.
O fato de o aumento no atraso ser constante ao longo dos pacotes reforça essa 
hipótese.

Além disso, o atraso do primeiro pacote é maior do que os demais. Analisando 
os arquivos PCAP gerados para ambas topoligas, vemos que isso é causado pelo 
tempo de inicilização necessário para estabelecer a conexão, como a criação do socket UDP 
e conexão com a porta do servidor. A Figura \ref{fig:atraso-pcap} 
ilustra esse efeito nos arquivos PCAP. Temos um atraso de 0.0349 segundos no 
primeiro pacote, e 0.0169 segundos nos demais.

\begin{figure}[htb]
	\centering 
    \caption{Atraso do primeiro pacote nos arquivos PCAP.}
	\includegraphics[width=\textwidth]{images/atraso-pcap.png}
	\label{fig:atraso-pcap}
	\fonte{Elaboração própria.}
\end{figure}


\chapter{Parte 3: Rede WiFi}

A topologia usada na parte 3 está exibida na Figura \ref{fig:topologia-p3}.
Temos dois pontos de acesso (AP) de duas redes Wi-Fi, de modo que os nós 
de cada rede podem comunicar entre si usandos esses APs.

\begin{figure}[htb]
	\centering 
    \caption{Topologia da parte 3.}
	\includegraphics[width=\textwidth]{images/topologia-p3.png}
	\label{fig:topologia-p3}
	\fonte{Elaboração própria.}
\end{figure}

Usando os logs de tempo da Figura \ref{fig:logs-p3}, podemos obter os 
atrasos de envio de pacotes e montar o gráfico da Figura \ref{fig:atraso-p3}.

\begin{figure}[htb]
	\centering 
    \caption{Logs com timestamps de envio e recebimento dos pacotes - parte 3.}
	\includegraphics[width=\textwidth]{images/logs-p3.png}
	\label{fig:logs-p3}
	\fonte{Elaboração própria.}
\end{figure}

\begin{figure}[htb]
	\centering 
    \caption{Gráfico com os atrasos de envios de pacotes na topologia com Wi-Fi.}
	\includegraphics[width=\textwidth]{images/atraso-p3.png}
	\label{fig:atraso-p3}
	\fonte{Elaboração própria.}
\end{figure}

Comparado com os atrasos em nós CSMA na rede Ethernet na Figura \ref{fig:plot-atraso-p2},
verificamos um comportamento similar: o envio do primeiro pacote é mais demorado devido à criação 
de sockets UDP e estabelecimento da conexão. Em seguinda, os demais pacotes tem 
delay menor com a conexão já estabelecida. 

As diferenças entre os tempos de delay observados são causadas pela diferença entre os meios
físicos de propagação dos pacotes: 
os nós CSMAs da parte 2 usam a rede cabeada através de Ethernet, enquanto a rede Wi-Fi 
usa o meio sem fio com ondas eletromagnéticas.


\chapter{Conclusão}


Texto conclusivo com a descrição do que você aprendeu e reforçou do conhecimento visto em sala de aula




